
К элементу `<html>` прикручивается класс `color-theme`, содержащий дефолтную белую тему. Изменяется тема с помощью классов-модификаторов типа `color-theme_name_***`. `***` — это название темы. Оно задаётся с помощью TV, которое так и называется — `сolor-theme_name`.

Если модификаторов нет, то используется дефолтная белая тема:

    <html class="color-theme">

Зелёная тема:

    <html class="color-theme color-theme_name_green">

Чтобы активировать тёмную тему надо добавить класс `color-theme_name_dark`. При этом удалять классы-модификаторы, которые были изначально, не нужно: это позволит восстановить тему, при переключении с тёмной на светлую. Достаточно просто удалить класс `color-theme_name_dark` и изначальная тема применится автоматически.

    <html class="color-theme color-theme_name_green color-theme_name_dark">

**Цветовая тема (color theme)** и **цветовой режим (color mode)** — разные понятия. Тема может быть белой, тёмной, красной, зелёной, какой угодно. Темы задаются в файле `_color-theme.scss`. Режим же может принимать только три значения: `light`, `darkAndColors` и `dark`. Он определяет присутствие тёмной темы на страницах сайта.

 - Когда используется режим `light`, класс `color-theme_name_dark` не используется вообще.
 - Когда используется режим `dark`, класс `color-theme_name_dark` присутствует всегда.
 - Когда используется режим `darkAndColors`, класс `color-theme_name_dark` используется только когда нет других модификаторов цветовой темы. То есть все цветные страницы остаются цветными, а страницы с дефолтной белой темой становятся тёмными.

Изначально страница всегда рендерится в режиме `light`, а потом при необходимости переводится в тёмную тему. Это вызывает «мерцание тёмной темы» («dark mode flash»). Поэтому тёмная тема устанавливается на бэкенде: если страница должна быть тёмной, то она сразу рендерится тёмной. Сервер решает добавлять ли ему класс `color-theme_name_dark` на основе cookie с названием `color-mode`. Код на PHP прописан в сниппете `color-theme_names`.

Когда пользователь приходит на сайт первый раз, у него не установлен `color-mode`. Он устанавливается на фронтенде файлом `color-theme.js` на основе медиа-запроса о предпочтениях пользователя (`prefers-color-scheme: dark`):

 - Если предпочитает тёмную, то ставим ему режим `darkAndColors`.
 - Если предпочитает светлую, то ставим режим `light`.

Кнопка, переключающая цветовые режимы, работает с тем же файлом `color-theme.js`. С помощью неё можно переключиться только на режимы `light` и `dark`. На `darkAndColors` переключиться нельзя, его можно только получить по дефолту.